# Lab4

> 计64 翁家翌 2016011446

## 练习1

根据注释对proc下的各个成员变量进行初始化即可，其中：

- `state` 设置为 `PROC_UNINIT` 为初始化状态
- `pid` 设置为 `-1`，表示未分配
- `cr3` 设置为 `boot_cr3`，为kernel初始化时页目录表的起始地址
- 其余所有值设为0，指针设为NULL



context保存了在内核态kernel进程切换的时候可能会被修改的寄存器，保证了各个进程之间的相对独立

trapframe保存了中断发生时进程在被打断之前的状态，用于到时候恢复中断前的现场

前者是用在不同进程的切换，后者用在某一进程的中断或异常。

## 练习2

翻译注释，但是要进行报错处理，具体如下：

1. 如果 proc 为 NULL，则表示无可用内存，跳转至 `fork_out`
2. 如果无法为 proc 分配内核栈，则跳转至 `bad_fork_cleanup_proc`，需要将之前的 `proc` 的页面释放掉
3. 如果在拷贝的时候挂了，则跳转至 `bad_fork_cleanup_kstack`，先释放已分配的栈空间，再释放 `proc` 的页面
4. 在调用 `get_pid`、插入链表之前需要关中断进行原子操作

新的线程的 `uid` 唯一，因为在调用 `get_pid` 函数之前已经关闭中断确保是原子操作，不会发生竞争。

## 练习3



## 总结

#### 本实验中重要的知识点，以及与对应的OS原理中的知识点

1. 

#### 本实验中没有对应的

1. ​                                                                                                                                                                           